# 应用特定提示（Tips）机制使用指南

## 功能说明

Tips机制允许为特定应用添加探索提示和限制，这些提示会自动添加到LLM的prompt中，指导探索行为。

## 文件结构

```
Explorer/
  ├── app_specific_tips.md       # Tips配置文件（Markdown格式）
  ├── tips_loader.py              # Tips加载器
  └── planner.py                  # Planner会自动加载和使用tips
```

## 添加新的应用提示

### 1. 编辑 `app_specific_tips.md`

在文件中找到 "## 应用特定提示" 章节，添加新的应用：

```markdown
### 应用名称 (app.package.name)

#### ⚠️ 严格禁止的操作
- 不要点击XXX按钮 - 原因说明
- 不要进入YYY页面 - 原因说明

#### 探索建议
- 对于ZZZ功能，建议采用AAA方式
- BBB页面加载较慢，需要等待

#### 已知问题
- CCC功能目前有bug，会导致DDD
```

### 2. 提示自动生效

无需修改代码，Planner在生成计划时会自动：
1. 根据 `ExplorationTarget.app_package` 匹配应用
2. 加载对应的应用特定提示
3. 将提示插入到LLM的prompt中

## 当前已配置的应用

### 麦当劳 (com.mcdonalds.gma.cn)

#### 严格禁止的操作
- ❌ 不要点击任何"提交订单"、"去支付"、"确认下单"按钮
- ❌ 不要点击"堡堡成双（板烧买一送一）"
- ❌ 不要在支付页面停留太久

#### 探索建议
- 选择普通套餐，避免活动套餐
- 套餐配品页面简单选择1-2个配品即可
- 购物车页面查看后立即返回

#### 原因说明
这些限制主要是为了：
1. 避免产生真实订单和扣款
2. 避免触发特殊活动的限制条件
3. 提高探索效率

## Tips的优先级

1. **应用特定提示** - 针对当前应用的特殊限制（最高优先级）
2. **通用提示** - 适用于所有应用的通用规则
3. **探索执行指南** - 默认的探索原则

## 示例：Tips在Prompt中的呈现

```
## ⚠️ 特殊注意事项

### 通用提示
#### 避免真实交易
- 涉及金钱交易时，只探索到支付确认页面，不要点击最终的"确认支付"按钮
...

### 应用特定提示（麦当劳）
#### ⚠️ 严格禁止的操作
- **不要点击任何"提交订单"、"去支付"、"确认下单"按钮** - 会产生真实订单
- **不要点击"堡堡成双（板烧买一送一）"** - 该活动有特殊限制，可能导致卡住或报错
...

**请严格遵守上述限制，避免产生真实订单或触发已知问题！**
```

## 调试和验证

### 查看Tips是否生效

1. 运行Explorer时，查看日志：
```
INFO | ExplorationPlanner | 加载了应用特定提示: 麦当劳
```

2. 查看生成的计划文件（`initial_plan.json`），检查LLM是否遵守了限制

### 测试新添加的Tips

1. 在 `app_specific_tips.md` 中添加新的提示
2. 运行Explorer
3. 观察LLM的行为是否符合预期
4. 根据效果调整提示的表述

## 最佳实践

### 提示的编写原则

1. **明确具体**
   - ❌ "不要做危险操作"
   - ✅ "不要点击'确认支付'按钮 - 会产生真实订单"

2. **说明原因**
   - 帮助LLM理解为什么要遵守这个限制
   - 例如："该活动有特殊限制，可能导致卡住"

3. **正面建议**
   - 不仅告诉LLM不要做什么
   - 也告诉它应该怎么做
   - 例如："购物车页面查看商品信息后立即返回"

4. **分级标记**
   - 使用 ⚠️ 和 ❌ 标记严重程度
   - 严格禁止的操作：❌
   - 需要注意的事项：⚠️

### 提示的维护

1. **定期更新**
   - 发现新的问题及时添加
   - 已修复的问题可以移除

2. **保持简洁**
   - 避免过多的提示影响LLM判断
   - 只记录重要的限制和建议

3. **测试验证**
   - 添加新提示后运行测试
   - 确认LLM能够正确理解和执行

## 扩展功能

### 支持多个应用

可以在同一个 `app_specific_tips.md` 文件中添加多个应用的提示：

```markdown
### 美团外卖 (com.sankuai.meituan.takeoutnew)
...

### 饿了么 (me.ele)
...

### 支付宝 (com.eg.android.AlipayGphone)
...
```

### 自定义Tips文件路径

如果需要使用不同的tips文件：

```python
from Explorer.tips_loader import AppSpecificTipsLoader

# 自定义tips文件
tips_loader = AppSpecificTipsLoader(
    tips_file=Path("/path/to/custom_tips.md")
)
```

## 故障排除

### Tips没有生效

1. 检查日志是否有加载提示的信息
2. 确认 `app_package` 匹配正确
3. 检查 `app_specific_tips.md` 文件格式

### LLM没有遵守Tips

1. 检查提示的表述是否够明确
2. 提示是否过于复杂，可以简化
3. 考虑提高提示的优先级（放在更显眼的位置）

---

**维护者**: 开发团队
**最后更新**: 2025-12-17
