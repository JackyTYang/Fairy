# Explorer æ¨¡å—å·¥ä½œåŸç†æ€»ç»“ï¼ˆæ¯•ä¸šè®ºæ–‡ç‰ˆï¼‰

**ä½œè€…**: æ¨ç‰¹ (Te Yang)
**å•ä½**: å¤æ—¦å¤§å­¦ CodeWisdom Lab
**æ—¶é—´**: 2025-12-22
**é¡¹ç›®**: Fairy - äº¤äº’å¼å¤šæ™ºèƒ½ä½“ç§»åŠ¨åŠ©æ‰‹

---

## ç›®å½•

1. [èƒŒæ™¯ä¸åŠ¨æœº](#1-èƒŒæ™¯ä¸åŠ¨æœº)
2. [ç³»ç»Ÿæ¦‚è¿°](#2-ç³»ç»Ÿæ¦‚è¿°)
3. [æ ¸å¿ƒè®¾è®¡](#3-æ ¸å¿ƒè®¾è®¡)
4. [å…³é”®æŠ€æœ¯å®ç°](#4-å…³é”®æŠ€æœ¯å®ç°)
5. [é‡åˆ°çš„éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ](#5-é‡åˆ°çš„éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ)
6. [å®éªŒç»“æœä¸è¯„ä¼°](#6-å®éªŒç»“æœä¸è¯„ä¼°)
7. [æ€»ç»“ä¸å±•æœ›](#7-æ€»ç»“ä¸å±•æœ›)

---

## 1. èƒŒæ™¯ä¸åŠ¨æœº

### 1.1 ç ”ç©¶èƒŒæ™¯

ç§»åŠ¨åº”ç”¨åŠŸèƒ½æ¢ç´¢ï¼ˆMobile App Explorationï¼‰æ˜¯ç§»åŠ¨åº”ç”¨æµ‹è¯•ã€ç†è§£å’Œè‡ªåŠ¨åŒ–çš„åŸºç¡€ä»»åŠ¡ã€‚ä¼ ç»Ÿçš„ç§»åŠ¨åº”ç”¨æµ‹è¯•å·¥å…·ï¼ˆå¦‚Monkeyã€UIAutomatorï¼‰ä¸»è¦ä¾èµ–éšæœºæˆ–åŸºäºè§„åˆ™çš„æ¢ç´¢ç­–ç•¥ï¼Œå­˜åœ¨ä»¥ä¸‹å±€é™æ€§ï¼š

1. **ç¼ºä¹è¯­ä¹‰ç†è§£**ï¼šæ— æ³•ç†è§£UIå…ƒç´ çš„è¯­ä¹‰å’ŒåŠŸèƒ½ç›®çš„
2. **æ¢ç´¢æ•ˆç‡ä½**ï¼šå¤§é‡æ— æ•ˆçš„éšæœºç‚¹å‡»ï¼Œéš¾ä»¥è¦†ç›–æ·±å±‚åŠŸèƒ½
3. **æ— çŸ¥è¯†ç§¯ç´¯**ï¼šæ¯æ¬¡æ¢ç´¢éƒ½æ˜¯ä»é›¶å¼€å§‹ï¼Œæ— æ³•å¤ç”¨å†å²ç»éªŒ
4. **éš¾ä»¥å¤„ç†å¤æ‚äº¤äº’**ï¼šæ— æ³•ç†è§£å¤šæ­¥éª¤çš„ä¸šåŠ¡æµç¨‹ï¼ˆå¦‚è´­ç‰©ã€æ”¯ä»˜ï¼‰

éšç€å¤§å‹å¤šæ¨¡æ€æ¨¡å‹ï¼ˆLMMï¼‰çš„å‘å±•ï¼ŒåŸºäºLMMçš„æ™ºèƒ½ä½“ï¼ˆAgentï¼‰å±•ç°å‡ºç†è§£å±å¹•å†…å®¹ã€è§„åˆ’è¡ŒåŠ¨åºåˆ—çš„èƒ½åŠ›ï¼Œä¸ºç§»åŠ¨åº”ç”¨åŠŸèƒ½æ¢ç´¢æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚

### 1.2 ç ”ç©¶åŠ¨æœº

æœ¬ç ”ç©¶çš„æ ¸å¿ƒåŠ¨æœºæ˜¯ï¼š**è®¾è®¡ä¸€ä¸ªåŸºäºLMMçš„è‡ªä¸»åŠŸèƒ½æ¢ç´¢ç³»ç»Ÿï¼Œèƒ½å¤Ÿç†è§£åº”ç”¨åŠŸèƒ½ç»“æ„ã€æ™ºèƒ½è§„åˆ’æ¢ç´¢è·¯å¾„ã€å¹¶æ„å»ºå¯å¤ç”¨çš„åŠŸèƒ½çŠ¶æ€æ ‘**ã€‚

å…·ä½“ç›®æ ‡ï¼š
- **ç›®æ ‡å¯¼å‘çš„æ¢ç´¢**ï¼šæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„åŠŸèƒ½ï¼ˆå¦‚"ç‚¹é¤"ã€"æ”¯ä»˜"ï¼‰è¿›è¡Œé’ˆå¯¹æ€§æ¢ç´¢
- **ç»“æ„åŒ–çŸ¥è¯†æ„å»º**ï¼šæ„å»ºåŠŸèƒ½æ ‘ï¼ˆFeature Treeï¼‰å’ŒçŠ¶æ€å›¾ï¼ˆState Graphï¼‰
- **åŠ¨æ€è§„åˆ’**ï¼šæ ¹æ®æ‰§è¡Œç»“æœåŠ¨æ€è°ƒæ•´æ¢ç´¢ç­–ç•¥
- **å®‰å…¨æ¢ç´¢**ï¼šé¿å…è§¦å‘çœŸå®æ”¯ä»˜ã€ä¸‹å•ç­‰ä¸å¯é€†æ“ä½œ

### 1.3 æ ¸å¿ƒè´¡çŒ®

1. **æå‡ºäº†åŸºäºLMMçš„åˆ†å±‚åŠŸèƒ½æ¢ç´¢æ¡†æ¶**ï¼šå°†åŠŸèƒ½æ¢ç´¢åˆ†è§£ä¸ºè®¡åˆ’ï¼ˆPlanï¼‰â†’ æ„ŸçŸ¥ï¼ˆPerceiveï¼‰â†’ æ‰§è¡Œï¼ˆExecuteï¼‰â†’ åæ€ï¼ˆReflectï¼‰çš„é—­ç¯
2. **è®¾è®¡äº†åŠŸèƒ½çŠ¶æ€æ ‘ï¼ˆFeature-State Treeï¼‰æ•°æ®ç»“æ„**ï¼šåˆ†å±‚å»ºæ¨¡åº”ç”¨çš„åŠŸèƒ½ç»“æ„å’Œé¡µé¢çŠ¶æ€
3. **å®ç°äº†åŒæˆªå›¾æœºåˆ¶ï¼ˆDual Screenshotï¼‰**ï¼šåŒæ—¶æ•è·å³æ—¶åé¦ˆï¼ˆ0.2ç§’ï¼‰å’Œç¨³å®šçŠ¶æ€ï¼ˆ5ç§’ï¼‰ï¼Œæå‡çŠ¶æ€è¯†åˆ«å‡†ç¡®æ€§
4. **è§£å†³äº†å¾ªç¯æ¢ç´¢é—®é¢˜**ï¼šé€šè¿‡å†å²çŠ¶æ€æ„ŸçŸ¥å’ŒåŠŸèƒ½å®Œæˆåº¦åˆ¤æ–­ï¼Œé¿å…LLMé™·å…¥é‡å¤æ“ä½œ

---

## 2. ç³»ç»Ÿæ¦‚è¿°

### 2.1 æ•´ä½“æ¶æ„

Explorer æ˜¯ Fairy ç³»ç»Ÿä¸­çš„åŠŸèƒ½æ¢ç´¢æ¨¡å—ï¼Œè´Ÿè´£åœ¨ç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ä¸­è‡ªä¸»æ¢ç´¢ç‰¹å®šåŠŸèƒ½ï¼Œæ„å»ºåŠŸèƒ½æ ‘å’ŒçŠ¶æ€å›¾ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FairyExplorer                       â”‚
â”‚                    (ä¸»åè°ƒå™¨)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚              â”‚              â”‚           â”‚
       â–¼              â–¼              â–¼           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Planner â”‚   â”‚Perceptorâ”‚   â”‚Executor â”‚  â”‚StateTrackâ”‚
  â”‚ (è§„åˆ’)   â”‚   â”‚ (æ„ŸçŸ¥)  â”‚   â”‚ (æ‰§è¡Œ)  â”‚  â”‚  (è·Ÿè¸ª) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚           â”‚
       â–¼              â–¼              â–¼           â–¼
  LLMæ¨ç†        å±å¹•æ•è·        ADBæ“ä½œ     çŠ¶æ€è®°å½•
  åŠ¨æ€é‡è§„åˆ’      SoMæ ‡æ³¨        åŠ¨ä½œæ‰§è¡Œ     å¿«ç…§ä¿å­˜
```

**æ ¸å¿ƒç»„ä»¶**ï¼ˆå…±2795è¡Œä»£ç ï¼‰ï¼š

| æ¨¡å— | ä»£ç é‡ | èŒè´£ |
|------|--------|------|
| `planner.py` | 638è¡Œ | LLMé©±åŠ¨çš„æ¢ç´¢è®¡åˆ’ç”Ÿæˆä¸åŠ¨æ€è°ƒæ•´ |
| `explorer.py` | 496è¡Œ | ä¸»åè°ƒå™¨ï¼Œç®¡ç†æ¢ç´¢å¾ªç¯ |
| `entities.py` | 385è¡Œ | æ•°æ®ç»“æ„å®šä¹‰ï¼ˆPlan, Step, State, Treeï¼‰ |
| `feature_tree_builder.py` | 338è¡Œ | åŠŸèƒ½æ ‘æ„å»ºä¸ç»´æŠ¤ |
| `state_tracker.py` | 219è¡Œ | æ‰§è¡Œå†å²è®°å½•ä¸å¿«ç…§ç®¡ç† |
| `perception_wrapper.py` | 174è¡Œ | å±å¹•æ„ŸçŸ¥æ¨¡å—å°è£… |
| `state_identifier.py` | 146è¡Œ | åŸºäºUIå“ˆå¸Œçš„çŠ¶æ€è¯†åˆ« |
| `tips_loader.py` | 159è¡Œ | åº”ç”¨ç‰¹å®šæç¤ºåŠ è½½ |
| `config.py` | 138è¡Œ | é…ç½®ç®¡ç† |

### 2.2 å·¥ä½œæµç¨‹

Explorer çš„å®Œæ•´å·¥ä½œæµç¨‹åˆ†ä¸º**åˆå§‹åŒ–**å’Œ**æ¢ç´¢å¾ªç¯**ä¸¤ä¸ªé˜¶æ®µï¼š

```
é˜¶æ®µ1: åˆå§‹åŒ–
â”œâ”€ 1. å±å¹•æ•è· (Perceptor)
â”‚   â””â”€ è·å–å½“å‰å±å¹•çš„æˆªå›¾ã€XMLã€SoMæ ‡æ³¨
â”œâ”€ 2. åˆå§‹è®¡åˆ’ç”Ÿæˆ (Planner)
â”‚   â”œâ”€ LLMåˆ†æå±å¹•å†…å®¹
â”‚   â”œâ”€ åˆ†è§£å­åŠŸèƒ½ (å¦‚: æµè§ˆèœå•, å•†å“è¯¦æƒ…, è´­ç‰©è½¦)
â”‚   â””â”€ ç”Ÿæˆåˆå§‹æ­¥éª¤åºåˆ—
â””â”€ 3. åŠŸèƒ½æ ‘åˆå§‹åŒ– (FeatureTreeBuilder)
    â””â”€ æ ¹æ®å­åŠŸèƒ½åˆ—è¡¨åˆ›å»ºæ ‘ç»“æ„

é˜¶æ®µ2: æ¢ç´¢å¾ªç¯ (æ¯æ­¥æ‰§è¡Œ)
â”œâ”€ 1. è·å–ä¸‹ä¸€æ­¥ (Planner.get_next_step)
â”œâ”€ 2. å±å¹•æ•è· (Perceptor)
â”œâ”€ 3. æ‰§è¡Œæ­¥éª¤ (Executor)
â”‚   â”œâ”€ æ¥æ”¶æŒ‡ä»¤ (å¦‚: "ç‚¹å‡»Mark 5ï¼Œè¿›å…¥å•†å“è¯¦æƒ…")
â”‚   â”œâ”€ è§£æå±å¹• (SoMæ˜ å°„)
â”‚   â”œâ”€ æ‰§è¡ŒåŠ¨ä½œ (Tap, Swipe, Back, etc.)
â”‚   â””â”€ åŒæˆªå›¾æ•è· (0.2ç§’ + 5ç§’)
â”œâ”€ 4. çŠ¶æ€è¯†åˆ« (StateIdentifier)
â”‚   â””â”€ åŸºäºActivity + UIå“ˆå¸Œç”Ÿæˆstate_id
â”œâ”€ 5. åŠŸèƒ½æ ‘æ›´æ–° (FeatureTreeBuilder)
â”‚   â”œâ”€ æ·»åŠ æ–°çŠ¶æ€åˆ°æ ‘ä¸­
â”‚   â””â”€ è®°å½•çŠ¶æ€è½¬ç§»å…³ç³»
â”œâ”€ 6. åˆ¤æ–­æ˜¯å¦é‡æ–°è§„åˆ’
â”‚   â”œâ”€ æ¡ä»¶1: é¡µé¢å‘ç”Ÿå˜åŒ–
â”‚   â”œâ”€ æ¡ä»¶2: å‘ç°æ–°åŠŸèƒ½
â”‚   â””â”€ æ¡ä»¶3: æ‰§è¡Œå¤±è´¥
â””â”€ 7. é‡æ–°è§„åˆ’ (Planner.replan)
    â”œâ”€ LLMåˆ†ææ‰§è¡Œç»“æœ
    â”œâ”€ åˆ¤æ–­åŠŸèƒ½å®Œæˆåº¦
    â”œâ”€ åŠ¨æ€ç”Ÿæˆåç»­æ­¥éª¤
    â””â”€ å¯èƒ½: æ·»åŠ æ–°å­åŠŸèƒ½ / åˆ‡æ¢åŠŸèƒ½ / è¿”å›ä¸Šçº§

ç»ˆæ­¢æ¡ä»¶:
â”œâ”€ æ‰€æœ‰è®¡åˆ’æ­¥éª¤æ‰§è¡Œå®Œæ¯•
â”œâ”€ è¾¾åˆ°æœ€å¤§æ­¥éª¤æ•° (max_exploration_steps)
â””â”€ ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­ (Ctrl+C)
```

### 2.3 æ•°æ®æµ

```
è¾“å…¥ (ExplorationTarget)
â”œâ”€ app_name: "éº¦å½“åŠ³"
â”œâ”€ app_package: "com.mcdonalds.gma.cn"
â”œâ”€ app_description: "æä¾›å¤–å–ç‚¹é¤æœåŠ¡"
â””â”€ feature_to_explore: "ç‚¹é¤åŠŸèƒ½"

â†“

æ¢ç´¢è¿‡ç¨‹ (æ¯æ­¥ç”Ÿæˆ)
â”œâ”€ ExplorationPlan: åŒ…å«æ­¥éª¤åˆ—è¡¨ã€åŠŸèƒ½ç»“æ„
â”œâ”€ PerceptionOutput: æˆªå›¾ã€XMLã€SoMæ˜ å°„ (Ã—2ï¼šå³æ—¶+ç¨³å®š)
â”œâ”€ ExecutionSnapshot: æ­¥éª¤å¿«ç…§ã€å¯¼èˆªè·¯å¾„
â””â”€ FeatureTree: åŠŸèƒ½èŠ‚ç‚¹ã€é¡µé¢çŠ¶æ€ã€è½¬ç§»å…³ç³»

â†“

è¾“å‡º (ExplorationResult)
â”œâ”€ feature_tree.json: åŠŸèƒ½çŠ¶æ€æ ‘
â”‚   â”œâ”€ features: {feature_id: {name, description, states, sub_features}}
â”‚   â”œâ”€ states: {state_id: {state_name, activity, perception, path_from_root}}
â”‚   â””â”€ state_transitions: [(from, to, step_id), ...]
â”œâ”€ feature_updates.json: åŠŸèƒ½æ ‘æ›´æ–°æ—¥å¿—
â”œâ”€ navigation_path.json: å¯¼èˆªè·¯å¾„
â”œâ”€ step_N/: æ¯æ­¥çš„è¯¦ç»†å¿«ç…§
â”‚   â”œâ”€ immediate/: ç«‹åˆ»æˆªå›¾ (0.2ç§’)
â”‚   â”œâ”€ stable/: ç¨³å®šæˆªå›¾ (5ç§’)
â”‚   â”œâ”€ executor_result.json: æ‰§è¡Œç»“æœ
â”‚   â””â”€ snapshot.json: å®Œæ•´å¿«ç…§
â””â”€ plan_after_step_N.json: æ¯æ­¥åçš„é‡æ–°è§„åˆ’
```

---

## 3. æ ¸å¿ƒè®¾è®¡

### 3.1 åŠŸèƒ½çŠ¶æ€æ ‘ï¼ˆFeature-State Treeï¼‰

åŠŸèƒ½çŠ¶æ€æ ‘æ˜¯ Explorer çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œé‡‡ç”¨**åˆ†å±‚è®¾è®¡**ï¼Œå°†åº”ç”¨çš„åŠŸèƒ½ç»“æ„å’Œé¡µé¢çŠ¶æ€åˆ†ç¦»å»ºæ¨¡ã€‚

#### 3.1.1 è®¾è®¡åŠ¨æœº

ä¼ ç»Ÿçš„GUIæµ‹è¯•å·¥å…·ï¼ˆå¦‚Monkeyï¼‰ä»…æ„å»ºå¹³é¢çš„çŠ¶æ€å›¾ï¼ˆState Graphï¼‰ï¼Œæ— æ³•è¡¨è¾¾åŠŸèƒ½çš„å±‚æ¬¡ç»“æ„ã€‚ä¾‹å¦‚ï¼š

- "ç‚¹é¤åŠŸèƒ½" åŒ…å« "æµè§ˆèœå•"ã€"å•†å“è¯¦æƒ…"ã€"è´­ç‰©è½¦"ç­‰å­åŠŸèƒ½
- æ¯ä¸ªå­åŠŸèƒ½å¯èƒ½è·¨è¶Šå¤šä¸ªé¡µé¢çŠ¶æ€
- åŒä¸€ä¸ªé¡µé¢çŠ¶æ€å¯èƒ½å±äºä¸åŒåŠŸèƒ½ï¼ˆå¦‚é¦–é¡µåŒæ—¶æ˜¯"æµè§ˆèœå•"å’Œ"æœç´¢"çš„å…¥å£ï¼‰

åŠŸèƒ½çŠ¶æ€æ ‘é€šè¿‡**åŠŸèƒ½èŠ‚ç‚¹ï¼ˆFeatureNodeï¼‰**å’Œ**é¡µé¢çŠ¶æ€ï¼ˆPageStateï¼‰**çš„ä¸¤å±‚ç»“æ„ï¼Œè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚

#### 3.1.2 æ•°æ®ç»“æ„å®šä¹‰

```python
@dataclass
class FeatureNode:
    """åŠŸèƒ½èŠ‚ç‚¹ - è¡¨ç¤ºåº”ç”¨çš„ä¸€ä¸ªåŠŸèƒ½æ¨¡å—"""
    feature_id: str              # å¦‚ "feature_1"
    feature_name: str            # å¦‚ "æµè§ˆèœå•"
    feature_description: str     # åŠŸèƒ½æè¿°
    parent_feature_id: str       # çˆ¶åŠŸèƒ½ID (æ”¯æŒå¤šå±‚åµŒå¥—)
    sub_features: List[str]      # å­åŠŸèƒ½IDåˆ—è¡¨
    states: List[str]            # è¯¥åŠŸèƒ½åŒ…å«çš„çŠ¶æ€IDåˆ—è¡¨
    entry_state_id: str          # å…¥å£çŠ¶æ€ID

@dataclass
class PageState:
    """é¡µé¢çŠ¶æ€ - è¡¨ç¤ºåº”ç”¨çš„ä¸€ä¸ªå…·ä½“é¡µé¢çŠ¶æ€"""
    state_id: str                    # å¦‚ "state_productlist_a3b2"
    state_name: str                  # å¦‚ "productlist_page"
    activity_name: str               # Android Activityåç§°
    perception_output: PerceptionOutput  # æˆªå›¾ã€XMLç­‰æ„ŸçŸ¥æ•°æ®
    path_from_root: List[PathStep]   # ä»åˆå§‹çŠ¶æ€åˆ°è¾¾æ­¤çŠ¶æ€çš„è·¯å¾„
    discovered_at: str               # å‘ç°æ—¶é—´
    reachable_states: List[str]      # å¯è¾¾çš„çŠ¶æ€IDåˆ—è¡¨

@dataclass
class FeatureTree:
    """åŠŸèƒ½çŠ¶æ€æ ‘ - æ•´ä½“ç»“æ„"""
    root_feature_id: str                 # æ ¹åŠŸèƒ½ID (é€šå¸¸æ˜¯ "root")
    features: Dict[str, FeatureNode]     # feature_id -> FeatureNode
    states: Dict[str, PageState]         # state_id -> PageState
    state_transitions: List[Tuple[str, str, str]]  # (from, to, step_id)
```

#### 3.1.3 æ ‘çš„æ„å»ºè¿‡ç¨‹

1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼šLLMåˆ†æç›®æ ‡åŠŸèƒ½ï¼Œç”Ÿæˆå­åŠŸèƒ½åˆ—è¡¨
   ```json
   {
     "feature_structure": {
       "root_feature": "ç‚¹é¤åŠŸèƒ½",
       "sub_features": [
         {"name": "æµè§ˆèœå•", "description": "æµè§ˆå•†å“åˆ†ç±»å’Œåˆ—è¡¨"},
         {"name": "å•†å“è¯¦æƒ…", "description": "æŸ¥çœ‹å•ä¸ªå•†å“è¯¦æƒ…å’Œè§„æ ¼"},
         {"name": "è´­ç‰©è½¦", "description": "ç®¡ç†å·²é€‰å•†å“å’Œæ•°é‡"},
         {"name": "ä¸‹å•ç»“ç®—", "description": "ç¡®è®¤è®¢å•å’Œæ”¯ä»˜"}
       ]
     }
   }
   ```

2. **æ¢ç´¢è¿‡ç¨‹ä¸­**ï¼šæ¯è®¿é—®ä¸€ä¸ªæ–°é¡µé¢çŠ¶æ€ï¼Œè®°å½•åˆ°æ ‘ä¸­
   ```python
   # è¯†åˆ«çŠ¶æ€
   state_id = StateIdentifier.identify_state(screen_info, perception)

   # æ·»åŠ åˆ°åŠŸèƒ½æ ‘
   feature_tree_builder.add_state(
       state_id=state_id,
       state_name="productlist_page",
       activity_name="com.mcdonalds.product.ProductListActivity",
       perception_output=perception,
       feature_path=["ç‚¹é¤åŠŸèƒ½", "æµè§ˆèœå•"],  # å½“å‰åŠŸèƒ½è·¯å¾„
       step_id="step_5",
       instruction="å‘ä¸‹æ»‘åŠ¨æµè§ˆæ›´å¤šå•†å“",
       actions=[{"name": "Swipe", "direction": "down"}],
       success=True
   )
   ```

3. **åŠ¨æ€æ›´æ–°**ï¼šLLMå‘ç°æ–°åŠŸèƒ½æ—¶ï¼ŒåŠ¨æ€æ·»åŠ èŠ‚ç‚¹
   ```json
   {
     "feature_update": {
       "action": "add_new",
       "details": {
         "new_feature": {
           "name": "é…é€æ—¶é—´è®¾ç½®",
           "description": "è®¾ç½®é¢„çº¦é€è¾¾æ—¶é—´",
           "parent_path": ["ç‚¹é¤åŠŸèƒ½"],
           "reason": "å‘ç°ç‹¬ç«‹çš„æ—¶é—´è®¾ç½®å¼¹çª—ï¼ŒåŠŸèƒ½ç»“æ„æ¯”é¢„æœŸå¤æ‚"
         }
       }
     }
   }
   ```

#### 3.1.4 æ ‘çš„åº”ç”¨ä»·å€¼

åŠŸèƒ½çŠ¶æ€æ ‘æ”¯æŒå¤šç§ä¸‹æ¸¸ä»»åŠ¡ï¼š

1. **åŠŸèƒ½è¦†ç›–ç‡åˆ†æ**ï¼šç»Ÿè®¡æ¯ä¸ªå­åŠŸèƒ½æ¢ç´¢äº†å¤šå°‘çŠ¶æ€
2. **æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**ï¼šæ ¹æ® `path_from_root` é‡æ”¾è·¯å¾„ï¼Œç”Ÿæˆæµ‹è¯•è„šæœ¬
3. **åŠŸèƒ½æ–‡æ¡£ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”ŸæˆåŠŸèƒ½è¯´æ˜æ–‡æ¡£
4. **å›å½’æµ‹è¯•**ï¼šæ£€æµ‹æ–°ç‰ˆæœ¬ä¸­çŠ¶æ€å˜åŒ–ï¼Œè¯†åˆ«UIæ”¹åŠ¨

### 3.2 åŸºäºLLMçš„åŠ¨æ€è§„åˆ’

#### 3.2.1 è§„åˆ’ç­–ç•¥

Explorer é‡‡ç”¨**åˆå§‹è§„åˆ’ + åŠ¨æ€é‡è§„åˆ’**çš„æ··åˆç­–ç•¥ï¼š

- **åˆå§‹è§„åˆ’ï¼ˆInitial Planï¼‰**ï¼šæ¢ç´¢å¼€å§‹æ—¶ï¼ŒLLMæ ¹æ®ç›®æ ‡åŠŸèƒ½å’Œé¦–é¡µæˆªå›¾ç”Ÿæˆåˆå§‹æ­¥éª¤
- **åŠ¨æ€é‡è§„åˆ’ï¼ˆReplanï¼‰**ï¼šæ¯æ­¥æ‰§è¡Œåï¼Œæ ¹æ®å®é™…ç»“æœé‡æ–°è§„åˆ’åç»­æ­¥éª¤

è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š
- **é€‚åº”æ€§**ï¼šèƒ½åº”å¯¹åŠ¨æ€å†…å®¹ã€ç½‘ç»œå»¶è¿Ÿã€æ„å¤–å¼¹çª—
- **çº é”™èƒ½åŠ›**ï¼šæ‰§è¡Œå¤±è´¥æ—¶å¯è°ƒæ•´ç­–ç•¥
- **æ·±åº¦æ¢ç´¢**ï¼šå‘ç°è®¡åˆ’å¤–çš„æ–°åŠŸèƒ½å¯å³æ—¶è°ƒæ•´è·¯å¾„

#### 3.2.2 Promptè®¾è®¡

**åˆå§‹è§„åˆ’ Prompt** åŒ…å«ï¼š
```
## æ¢ç´¢ç›®æ ‡
- åº”ç”¨åç§°: éº¦å½“åŠ³
- åŠŸèƒ½æè¿°: ç‚¹é¤åŠŸèƒ½
- å½“å‰å±å¹•: [æˆªå›¾] + [æ–‡æœ¬æè¿°]

## æ¢ç´¢æ‰§è¡ŒæŒ‡å—
- ç›®æ ‡å®šä½: å‘ç°åŠŸèƒ½ã€ç†è§£ç»“æ„ï¼ˆéè¾¹ç•Œæµ‹è¯•ï¼‰
- å®‰å…¨å‡†åˆ™: é¿å…çœŸå®æ”¯ä»˜ã€ä¸‹å•
- å¤±è´¥ç­–ç•¥: è¿ç»­å¤±è´¥2-3æ¬¡åæ”¾å¼ƒå½“å‰è·¯å¾„
- å¤šæ ·åŒ–æ“ä½œ: åˆç†ä½¿ç”¨ç‚¹å‡»ã€æ»‘åŠ¨ã€é•¿æŒ‰

## åŠŸèƒ½ç»“æ„åˆ†æ
è¯·åˆ†æåŠŸèƒ½çš„å±‚æ¬¡ç»“æ„ï¼š
1. æ ¹åŠŸèƒ½: ç‚¹é¤åŠŸèƒ½
2. å­åŠŸèƒ½: åˆ—ä¸¾2-5ä¸ªå­åŠŸèƒ½
3. ä¸ºæ¯ä¸ªå­åŠŸèƒ½æä¾›æè¿°

## è¾“å‡ºæ ¼å¼
{
  "plan_thought": "è®¡åˆ’æ€è€ƒè¿‡ç¨‹",
  "overall_plan": "æ•´ä½“è®¡åˆ’æè¿°",
  "feature_structure": { å­åŠŸèƒ½åˆ—è¡¨ },
  "current_feature": { å½“å‰åŠŸèƒ½è·¯å¾„ },
  "steps": [
    {
      "step_id": "step_1",
      "instruction": "å…·ä½“æ“ä½œæŒ‡ä»¤",
      "sub_goal": "æ­¥éª¤ç›®æ ‡",
      "enable_reflection": true,
      "max_iterations": 5
    }
  ]
}
```

**é‡è§„åˆ’ Prompt** å¢åŠ ï¼š
```
## å½“å‰æ¢ç´¢çŠ¶æ€
- å·²å®Œæˆæ­¥éª¤: [step_1, step_2, ...]
- å¯¼èˆªè·¯å¾„: é¦–é¡µ -> èœå•é¡µ -> å•†å“è¯¦æƒ…
- å½“å‰åŠŸèƒ½: ç‚¹é¤åŠŸèƒ½ -> å•†å“è¯¦æƒ…

## ä¸Šä¸€æ­¥æ‰§è¡Œç»“æœ
- æ­¥éª¤: step_5
- æŒ‡ä»¤: ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"
- æˆåŠŸ: True
- è¿­ä»£æ¬¡æ•°: 1
- æ‰§è¡Œæ—¶é—´: 3.2ç§’

## å½“å‰å±å¹•ä¿¡æ¯
- ç«‹åˆ»æˆªå›¾ (0.2ç§’): [å¯èƒ½åŒ…å«toastæç¤º]
- ç¨³å®šæˆªå›¾ (5ç§’): [é¡µé¢å®Œå…¨åŠ è½½]
- æ–‡æœ¬æè¿°: [å‹ç¼©åçš„UIå…ƒç´ åˆ—è¡¨]

## åŠŸèƒ½çŠ¶æ€åˆ¤æ–­
A. æ˜¯å¦è¿˜åœ¨å½“å‰åŠŸèƒ½ä¸­ï¼Ÿ
B. å¦‚æœä¸åœ¨ï¼Œå±äº: å·²æœ‰å­åŠŸèƒ½ / æ–°å­åŠŸèƒ½ / å­å­åŠŸèƒ½ï¼Ÿ
C. æ˜¯å¦éœ€è¦æ›´æ–°åŠŸèƒ½ç»“æ„ï¼Ÿ
```

#### 3.2.3 é‡è§„åˆ’è§¦å‘æ¡ä»¶

```python
def _should_replan(self, step_num, step, executor_result):
    """åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°è§„åˆ’"""
    # æ¡ä»¶1: æ¯æ­¥æ‰§è¡Œåéƒ½é‡æ–°è§„åˆ’ï¼ˆç¡®ä¿åŠ¨æ€å“åº”ï¼‰
    return True

    # å¤‡é€‰ç­–ç•¥ï¼ˆæ›´é«˜æ•ˆä½†å¯èƒ½é”™è¿‡å˜åŒ–ï¼‰ï¼š
    # - é¡µé¢å‘ç”Ÿå˜åŒ–æ—¶
    # - æ‰§è¡Œå¤±è´¥æ—¶
    # - è¾¾åˆ°å…³é”®æ­¥éª¤ï¼ˆå¦‚æ¯5æ­¥ï¼‰
```

å½“å‰å®ç°é€‰æ‹©**æ¯æ­¥é‡è§„åˆ’**ä»¥æœ€å¤§åŒ–é€‚åº”æ€§ï¼Œæœªæ¥å¯ä¼˜åŒ–ä¸ºæ¡ä»¶è§¦å‘ä»¥é™ä½LLMè°ƒç”¨æˆæœ¬ã€‚

### 3.3 çŠ¶æ€è¯†åˆ«æœºåˆ¶

#### 3.3.1 è®¾è®¡ç›®æ ‡

çŠ¶æ€è¯†åˆ«ï¼ˆState Identificationï¼‰éœ€è¦è§£å†³ï¼š
- **åŒæ„åˆ¤å®š**ï¼šä¸¤ä¸ªå±å¹•æ˜¯å¦è¡¨ç¤ºåŒä¸€çŠ¶æ€ï¼Ÿ
- **çŠ¶æ€å”¯ä¸€æ€§**ï¼šä¸ºæ¯ä¸ªä¸åŒçš„çŠ¶æ€ç”Ÿæˆå”¯ä¸€ID
- **é²æ£’æ€§**ï¼šè¿‡æ»¤åŠ¨æ€å†…å®¹ï¼ˆæ—¶é—´ã€è®¡æ•°å™¨ã€å¹¿å‘Šï¼‰çš„å¹²æ‰°

#### 3.3.2 å®ç°æ–¹æ¡ˆ

é‡‡ç”¨ **Activity + UIç»“æ„å“ˆå¸Œ** çš„æ··åˆç­–ç•¥ï¼š

```python
state_id = f"state_{activity_short}_{ui_hash}"

# Activity: com.mcdonalds.product.ProductListActivity
# â†’ activity_short: productlist

# UIå“ˆå¸Œ: åŸºäºå‹ç¼©åçš„UIæ–‡æœ¬è®¡ç®—MD5
ui_hash = md5(filtered_ui_text)[:8]  # å–å‰8ä½

# æœ€ç»ˆ: state_productlist_a3b24f5c
```

**UIæ–‡æœ¬è¿‡æ»¤**ï¼š
```python
def _filter_dynamic_content(ui_text):
    # ç§»é™¤çº¯æ•°å­—
    text = re.sub(r'\b\d+\b', '', ui_text)
    # ç§»é™¤æ—¶é—´æ ¼å¼ (HH:MM, YYYY-MM-DD)
    text = re.sub(r'\d{1,2}:\d{2}', '', text)
    text = re.sub(r'\d{4}-\d{2}-\d{2}', '', text)
    # ç§»é™¤å¤šä½™ç©ºç™½
    text = re.sub(r'\s+', ' ', text)
    return text.strip()
```

#### 3.3.3 å·²è¯†åˆ«é—®é¢˜ä¸æ”¹è¿›

**é—®é¢˜**ï¼šå¼¹çª—æ‰“å¼€å‰åè¢«è¯†åˆ«ä¸ºåŒä¸€çŠ¶æ€
- åŸå› ï¼šå¼¹çª—æ˜¯æ‚¬æµ®å±‚ï¼Œåº•å±‚UIç»“æ„æœªå˜åŒ–
- å½±å“ï¼šå¯¼è‡´å¾ªç¯æ¢ç´¢ï¼ˆè¯¦è§ [5.1èŠ‚](#51-å¾ªç¯æ¢ç´¢é—®é¢˜)ï¼‰

**æ”¹è¿›æ–¹æ¡ˆ**ï¼šæ£€æµ‹å¼¹çª—ç‰¹å¾
```python
# æ£€æµ‹å¼¹çª—å…³é”®è¯
dialog_markers = ['Dialog', 'Popup', 'Modal', 'view_dialog_bg']
has_dialog = any(marker in ui_text for marker in dialog_markers)

# åœ¨å“ˆå¸Œä¸­åŠ å…¥å¼¹çª—æ ‡è®°
ui_text_with_dialog = f"[DIALOG:{has_dialog}]" + ui_text
```

---

## 4. å…³é”®æŠ€æœ¯å®ç°

### 4.1 åŒæˆªå›¾æœºåˆ¶ï¼ˆDual Screenshotï¼‰

#### 4.1.1 è®¾è®¡åŠ¨æœº

ç§»åŠ¨åº”ç”¨çš„UIåé¦ˆåˆ†ä¸ºä¸¤ç±»ï¼š
1. **å³æ—¶åé¦ˆ**ï¼šToastæç¤ºã€é”™è¯¯æ¶ˆæ¯ã€LoadingåŠ¨ç”»ï¼ˆæŒç»­0.5-2ç§’ï¼‰
2. **ç¨³å®šçŠ¶æ€**ï¼šé¡µé¢å®Œå…¨åŠ è½½åçš„æœ€ç»ˆçŠ¶æ€ï¼ˆéœ€ç­‰å¾…3-5ç§’ï¼‰

ä¼ ç»Ÿæ–¹æ³•åªæ•è·ä¸€æ¬¡æˆªå›¾ï¼Œå¯èƒ½é”™è¿‡çŸ­æš‚çš„å³æ—¶åé¦ˆï¼Œæˆ–åœ¨é¡µé¢åŠ è½½ä¸­é€”æ•è·å¯¼è‡´ä¿¡æ¯ä¸å®Œæ•´ã€‚

#### 4.1.2 å®ç°æ–¹æ¡ˆ

**åŒæˆªå›¾ç­–ç•¥**ï¼š
```python
# æ‰§è¡ŒåŠ¨ä½œåç«‹å³æ•è·ï¼ˆ0.2ç§’ï¼‰
immediate_screenshot = await capture_screenshot(delay=0.2)

# ç­‰å¾…é¡µé¢ç¨³å®šåæ•è·ï¼ˆ5ç§’ï¼‰
time.sleep(5)
stable_screenshot = await capture_screenshot(delay=0)
```

**å®Œæ•´çš„æ„ŸçŸ¥æ•°æ®**ï¼š
```python
@dataclass
class PerceptionOutput:
    # ç¨³å®šæˆªå›¾ (5ç§’)
    screenshot_path: str
    marked_screenshot_path: str
    xml_path: str
    compressed_txt_path: str
    som_mapping_path: str

    # ç«‹åˆ»æˆªå›¾ (0.2ç§’)
    immediate_screenshot_path: Optional[str]
    immediate_marked_screenshot_path: Optional[str]
    immediate_xml_path: Optional[str]
    immediate_compressed_txt_path: Optional[str]
    immediate_som_mapping_path: Optional[str]
```

#### 4.1.3 åœ¨Plannerä¸­çš„åº”ç”¨

é‡è§„åˆ’æ—¶ï¼ŒLLMåŒæ—¶æ¥æ”¶ä¸¤å¼ æˆªå›¾ï¼š

```python
if immediate_screenshot:
    images = [immediate_screenshot, stable_screenshot]
    prompt += """
    æˆ‘ä»¬æä¾›äº†ä¸¤å¼ æˆªå›¾ï¼š
    1. ç«‹åˆ»æˆªå›¾ (0.2ç§’): å¯èƒ½åŒ…å«toast/é”™è¯¯æç¤º
    2. ç¨³å®šæˆªå›¾ (5ç§’): é¡µé¢å®Œå…¨åŠ è½½

    è¯·ç‰¹åˆ«å…³æ³¨ç«‹åˆ»æˆªå›¾ä¸­çŸ­æš‚å‡ºç°çš„æç¤ºä¿¡æ¯ï¼
    """
else:
    images = [stable_screenshot]
```

**æ•ˆæœ**ï¼šæ˜¾è‘—æå‡äº†å¯¹ä»¥ä¸‹åœºæ™¯çš„è¯†åˆ«å‡†ç¡®ç‡
- è¡¨å•æäº¤å¤±è´¥çš„é”™è¯¯æç¤º
- "åŠ å…¥è´­ç‰©è½¦æˆåŠŸ"çš„Toast
- ç½‘ç»œè¯·æ±‚çš„LoadingçŠ¶æ€

### 4.2 SoMå¢å¼ºï¼ˆSet-of-Marksï¼‰

#### 4.2.1 é—®é¢˜èƒŒæ™¯

ä¹‹å‰ç« èŠ‚ï¼ˆSOM_BUG_FIX_SUMMARY.mdï¼‰å·²è¯¦ç»†è®°å½•äº†SoMåæ ‡æ˜ å°„é—®é¢˜ï¼š
- **é—®é¢˜**ï¼š`SoM_mapping` å’Œ `compressed_txt` ä½¿ç”¨ä¸åŒæ•°æ®æºï¼Œå¯¼è‡´Markç¼–å·ä¸å¯¹åº”
- **å½±å“**ï¼šLLMé€‰æ‹©äº†æ­£ç¡®çš„Markç¼–å·ï¼Œä½†ç‚¹å‡»åˆ°äº†é”™è¯¯çš„ä½ç½®

#### 4.2.2 è§£å†³æ–¹æ¡ˆï¼šæ•°æ®æºç»Ÿä¸€

**ä¿®å¤å‰**ï¼š
```
SoM_mapping: ä»AccessibilityTreeéå†ç”Ÿæˆ
compressed_txt: ä»CompressedXMLéå†ç”Ÿæˆ
â†’ èŠ‚ç‚¹é¡ºåºä¸ä¸€è‡´ï¼
```

**ä¿®å¤å**ï¼š
```python
# screen_perception_AT.py
def _add_node(node, type):
    # â­ å­˜å‚¨å®Œæ•´èŠ‚ç‚¹ä¿¡æ¯
    nodes_need_marked[type]['node_info_list'][index] = {
        'class': node.get('class'),
        'resource-id': node.get('resource-id'),
        'text': combined_text,  # é€’å½’æå–æ‰€æœ‰å­èŠ‚ç‚¹æ–‡æœ¬
        'center': node.get('center'),
        'bounds': node.get('bounds')
    }

# perceptor.py
def _generate_compressed_txt_from_nodes(nodes_need_marked):
    # â­ ä»åŒä¸€æ•°æ®æºç”Ÿæˆcompressed_txt
    for idx in sorted(nodes_need_marked['clickable']['node_info_list'].keys()):
        info = nodes_need_marked['clickable']['node_info_list'][idx]
        line = f"Mark {idx}: {info['class']} [{info['text']}] [Center: {info['center']}]"
        lines.append(line)
```

**éªŒè¯ç»“æœ**ï¼š28/28 å®Œç¾åŒ¹é…ï¼ˆè·ç¦» < 1pxï¼‰

#### 4.2.3 æ··åˆæ¨¡å¼ï¼ˆHybrid Modeï¼‰

**é—®é¢˜**ï¼šLLMä»…çœ‹åˆ°æ ‡è®°åçš„å›¾åƒï¼Œå°æ–‡æœ¬éš¾ä»¥è¯†åˆ«

**è§£å†³**ï¼šè§†è§‰ + æ–‡æœ¬æ··åˆæ¨¡å¼
```python
# entity.py
def get_screen_info_prompt(self):
    if not self.non_visual_mode and self.som_compressed_txt:
        prompt += """
        ## Marked Elements List
        Below is the list of all marked elements with text content:

        Mark 26: RelativeLayout (rl_time_card) [é¢„çº¦] [Center: [1140, 443]]
        Mark 27: TextView [å°½å¿«é€è¾¾] [Center: [890, 550]]
        ...

        **Note**: Use the Mark number to select elements.
        The text helps you identify the correct element.
        """
```

**æ•ˆæœ**ï¼šLLMå†³ç­–å‡†ç¡®ç‡ä» 70-80% æå‡è‡³ 95%+

### 4.3 åº”ç”¨ç‰¹å®šæç¤ºï¼ˆApp-Specific Tipsï¼‰

#### 4.3.1 è®¾è®¡æ€è·¯

ä¸åŒåº”ç”¨æœ‰ä¸åŒçš„UIæ¨¡å¼å’Œä¸šåŠ¡é€»è¾‘ï¼Œé€šç”¨çš„æ¢ç´¢ç­–ç•¥å¯èƒ½ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼š
- ç”µå•†åº”ç”¨ï¼šéœ€é¿å…çœŸå®ä¸‹å•
- ç¤¾äº¤åº”ç”¨ï¼šéœ€æ³¨æ„éšç§ä¿æŠ¤
- é‡‘èåº”ç”¨ï¼šéœ€é¿å…è½¬è´¦æ“ä½œ

é€šè¿‡åŠ è½½åº”ç”¨ç‰¹å®šçš„æç¤ºï¼ˆTipsï¼‰ï¼Œå¯ä»¥ï¼š
- æŒ‡å¯¼LLMé’ˆå¯¹ç‰¹å®šåº”ç”¨çš„æ¢ç´¢ç­–ç•¥
- æé†’å±é™©æ“ä½œ
- æä¾›ä¸šåŠ¡æµç¨‹çŸ¥è¯†

#### 4.3.2 å®ç°

**ç›®å½•ç»“æ„**ï¼š
```
Explorer/
â””â”€â”€ app_specific_tips/
    â”œâ”€â”€ com.mcdonalds.gma.cn.txt     # éº¦å½“åŠ³App
    â”œâ”€â”€ com.taobao.taobao.txt        # æ·˜å®App
    â”œâ”€â”€ com.tencent.mm.txt           # å¾®ä¿¡
    â””â”€â”€ common.txt                   # é€šç”¨æç¤º
```

**Tipsç¤ºä¾‹** (`com.mcdonalds.gma.cn.txt`)ï¼š
```
## éº¦å½“åŠ³Appæ¢ç´¢æç¤º

### æ ¸å¿ƒæµç¨‹
1. æµè§ˆèœå•ï¼šé¦–é¡µç›´æ¥æ˜¾ç¤ºå•†å“åˆ—è¡¨
2. å•†å“è¯¦æƒ…ï¼šç‚¹å‡»å•†å“å¡ç‰‡è¿›å…¥
3. è´­ç‰©è½¦ï¼šåº•éƒ¨è´­ç‰©è½¦æŒ‰é’®
4. ç»“ç®—ï¼šç‚¹å‡»"å»ç»“ç®—"ï¼Œä½†ä¸è¦ç‚¹å‡»æœ€ç»ˆæ”¯ä»˜æŒ‰é’®

### ç‰¹æ®Šæ³¨æ„
- é…é€åœ°å€ï¼šå¯èƒ½éœ€è¦å…ˆè®¾ç½®åœ°å€æ‰èƒ½ç‚¹é¤
- é¢„çº¦æ—¶é—´ï¼šé¡¶éƒ¨æœ‰"é¢„çº¦"/"å°½å¿«é€è¾¾"åˆ‡æ¢
- ä¼˜æƒ åˆ¸ï¼šç»“ç®—é¡µé¢å¯æŸ¥çœ‹ï¼Œä½†ä¸è¦å®é™…ä½¿ç”¨

### å±é™©æ“ä½œ
âŒ ä¸è¦ç‚¹å‡»"ç¡®è®¤æ”¯ä»˜"
âŒ ä¸è¦ä¿®æ”¹çœŸå®åœ°å€ä¿¡æ¯
```

**åŠ è½½é€»è¾‘**ï¼š
```python
class TipsLoader:
    def get_tips_for_app(self, app_package, app_name):
        # 1. å°è¯•åŠ è½½åŒ…ååŒ¹é…çš„tips
        tips_file = TIPS_DIR / f"{app_package}.txt"
        if tips_file.exists():
            return self._load_file(tips_file)

        # 2. å°è¯•æ¨¡ç³ŠåŒ¹é…app_name
        for file in TIPS_DIR.glob("*.txt"):
            if app_name.lower() in file.stem.lower():
                return self._load_file(file)

        # 3. è¿”å›é€šç”¨tips
        return self._load_file(TIPS_DIR / "common.txt")
```

**åœ¨Promptä¸­æ³¨å…¥**ï¼š
```python
def _build_initial_plan_prompt(self, target, screen_text):
    prompt = f"""
    ## æ¢ç´¢ç›®æ ‡
    ...

    {self._get_app_specific_tips(target)}  # â­ æ³¨å…¥Tips

    ## ä»»åŠ¡
    ...
    """
```

### 4.4 ä¿¡å·å¤„ç†ä¸æ•°æ®æŒä¹…åŒ–

#### 4.4.1 é—®é¢˜åœºæ™¯

ç”¨æˆ·è¿è¡Œ Explorer æ¢ç´¢å¤§å‹åº”ç”¨ï¼ˆå¦‚ç”µå•†Appï¼‰å¯èƒ½éœ€è¦æ•°å°æ—¶ã€‚æœŸé—´å¯èƒ½ï¼š
- æ‰‹åŠ¨ä¸­æ–­ï¼ˆCtrl+Cï¼‰æ£€æŸ¥è¿›åº¦
- ç³»ç»Ÿå´©æºƒ
- è¿›ç¨‹è¢«kill

ä¼ ç»Ÿåšæ³•åœ¨è¿›ç¨‹ç»“æŸæ—¶ä¸¢å¤±æ‰€æœ‰ä¸­é—´æ•°æ®ï¼Œå¯¼è‡´å¿…é¡»ä»å¤´é‡æ–°æ¢ç´¢ã€‚

#### 4.4.2 è§£å†³æ–¹æ¡ˆï¼šä¿¡å·æ•è·

```python
def _register_signal_handlers(self):
    def signal_handler(signum, frame):
        logger.warning(f"æ”¶åˆ°ä¿¡å· {signal.Signals(signum).name}ï¼Œæ­£åœ¨ä¿å­˜æ•°æ®...")

        # ä¿å­˜åŠŸèƒ½æ ‘
        self._save_feature_tree(reason=f"æ”¶åˆ°{signal_name}ä¿¡å·")

        # ä¿å­˜å¯¼èˆªè·¯å¾„
        self.state_tracker.save_navigation_path()

        sys.exit(0)

    signal.signal(signal.SIGINT, signal_handler)   # Ctrl+C
    signal.signal(signal.SIGTERM, signal_handler)  # killå‘½ä»¤
```

**ä¿å­˜å†…å®¹**ï¼š
```
output/20251220_172306/
â”œâ”€â”€ feature_tree.json          # â­ ä¸­é€”åŠŸèƒ½æ ‘
â”œâ”€â”€ feature_updates.json       # åŠŸèƒ½æ›´æ–°æ—¥å¿—
â”œâ”€â”€ navigation_path.json       # å¯¼èˆªè·¯å¾„
â”œâ”€â”€ step_1/ ... step_7/        # å·²å®Œæˆçš„æ­¥éª¤å¿«ç…§
â””â”€â”€ plan_after_step_7.json     # æœ€åçš„è®¡åˆ’
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
```bash
$ python explorer.py --app com.mcdonalds.gma.cn

[æ‰§è¡Œä¸­...]
Step 5: ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦" âœ“

^C  # ç”¨æˆ·æŒ‰ä¸‹Ctrl+C

âš ï¸ æ”¶åˆ°ä¿¡å· SIGINTï¼Œæ­£åœ¨ä¿å­˜æ•°æ®...
âœ“ åŠŸèƒ½æ ‘å·²ä¿å­˜ï¼ˆåŸå› : æ”¶åˆ°SIGINTä¿¡å·ï¼‰
âœ“ å¯¼èˆªè·¯å¾„å·²ä¿å­˜
è¾“å‡ºç›®å½•: output/20251220_172306/

$ ls output/20251220_172306/
feature_tree.json  (æ„å»ºåˆ°ä¸€åŠçš„åŠŸèƒ½æ ‘å·²ä¿å­˜ï¼)
```

---

## 5. é‡åˆ°çš„éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 å¾ªç¯æ¢ç´¢é—®é¢˜

#### 5.1.1 é—®é¢˜æè¿°

**ç°è±¡**ï¼šExplorer åœ¨åŒä¸€ä¸ªå¼¹çª—å†…åå¤ç‚¹å‡»"é¢„çº¦é€é¤"å’Œ"å°½å¿«é€è¾¾"ï¼Œè¿ç»­5æ­¥åœç•™åœ¨åŒä¸€çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•è¿›å±•ã€‚

**å…·ä½“æ¡ˆä¾‹**ï¼ˆä¼šè¯ `20251220_172306`ï¼‰ï¼š

| æ­¥éª¤ | æŒ‡ä»¤ | çŠ¶æ€è½¬ç§» | é—®é¢˜ |
|------|------|----------|------|
| Step 3 | ç‚¹å‡»"é¢„çº¦é€é¤"å¹¶è§‚å¯Ÿé€‰ä¸­æ€ | `state_e960fb61` â†’ `state_e960fb61` | æ­£å¸¸æ¢ç´¢ |
| Step 4 | ç‚¹å‡»"ç¡®å®š" | `state_e960fb61` â†’ `state_e960fb61` | âŒ åè€Œç‚¹äº†"é¢„çº¦"æŒ‰é’® |
| Step 5 | ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª— | `state_e960fb61` â†’ `state_e960fb61` | âŒ å¼¹çª—ä¸æ”¯æŒæ­¤æ“ä½œ |
| Step 6 | å†æ¬¡ç‚¹å‡»"é¢„çº¦é€é¤" | `state_e960fb61` â†’ `state_e960fb61` | âŒ é‡å¤Step 3 |
| Step 7 | ç‚¹å‡»"å°½å¿«é€è¾¾" | `state_e960fb61` â†’ `state_e960fb61` | âŒ é‡å¤æ“ä½œ |

**å½±å“**ï¼š
- æ¢ç´¢æ•ˆç‡ä½ä¸‹ï¼ˆ5æ­¥æ— è¿›å±•ï¼‰
- æµªè´¹LLMè°ƒç”¨æˆæœ¬
- æ— æ³•è¦†ç›–æ·±å±‚åŠŸèƒ½

#### 5.1.2 æ ¹æœ¬åŸå› åˆ†æ

**åŸå› 1ï¼šçŠ¶æ€è¯†åˆ«ç²’åº¦ä¸è¶³**

StateIdentifier åŸºäº Activity + UIå“ˆå¸Œè¯†åˆ«çŠ¶æ€ï¼š
```python
state_id = f"state_{activity_short}_{ui_hash}"
```

å¼¹çª—æ‰“å¼€å‰åï¼š
- Activityç›¸åŒï¼š`ProductListActivity`
- UIå“ˆå¸Œç›¸åŒï¼šåº•å±‚UIç»“æ„æœªå˜ï¼Œå“ˆå¸Œè¿‡æ»¤åŠ¨æ€å†…å®¹åä¸€è‡´
- **ç»“æœ**ï¼šè¢«è¯†åˆ«ä¸ºåŒä¸€çŠ¶æ€ `state_productlist_e960fb61`

**åŸå› 2ï¼šç¼ºå°‘åŠŸèƒ½å®Œæˆåº¦åˆ¤æ–­**

Planner çš„ Replan Prompt è¦æ±‚LLMåˆ¤æ–­"æ˜¯å¦è¿˜åœ¨å½“å‰åŠŸèƒ½ä¸­"ï¼Œä½†**æ²¡æœ‰æ˜ç¡®è¦æ±‚**ï¼š
- "å¦‚æœåŠŸèƒ½å·²å……åˆ†æ¢ç´¢ï¼Œåº”è¯¥ç»“æŸå¹¶è¿”å›"
- "å¦‚æœè¿ç»­å¤šæ¬¡åœ¨åŒä¸€çŠ¶æ€ï¼Œåº”è¯¥æ„è¯†åˆ°é™·å…¥å¾ªç¯"

LLMä¸çŸ¥é“"ä¸¤ä¸ªæ¨¡å¼éƒ½ç‚¹è¿‡äº†"å°±ç®—å®Œæˆã€‚

**åŸå› 3ï¼šæ²¡æœ‰æä¾›å†å²æ¢ç´¢è®°å½•**

LLMçœ‹åˆ°çš„ä¸Šä¸‹æ–‡ï¼š
- âœ… å·²å®Œæˆçš„æ­¥éª¤IDåˆ—è¡¨ï¼š`["step_1", "step_2", "step_3"]`
- âœ… ä¸Šä¸€æ­¥æ‰§è¡Œç»“æœï¼š`{"step_id": "step_3", "success": True}`
- âœ… å¯¼èˆªè·¯å¾„åç§°ï¼š`["é¦–é¡µ", "èœå•é¡µ", "æ—¶é—´è®¾ç½®å¼¹çª—"]`
- âŒ **çŠ¶æ€è½¬ç§»å†å²**ï¼šçœ‹ä¸åˆ°è¿ç»­5æ­¥éƒ½æ˜¯ `state_e960fb61 â†’ state_e960fb61`
- âŒ **æ“ä½œå†å²**ï¼šçœ‹ä¸åˆ°"é¢„çº¦é€é¤"åœ¨Step 3å·²ç»ç‚¹è¿‡äº†

**åŸå› 4ï¼šFeature Tree ä¸ Planner çš„ä¿¡æ¯æ–­å±‚**

`FeatureTreeBuilder` å·²è®°å½•ï¼š
- æ‰€æœ‰å·²æ¢ç´¢çš„çŠ¶æ€
- çŠ¶æ€è½¬ç§»å…³ç³»ï¼š`[(state_A, state_B, step_2), (state_B, state_B, step_3), ...]`

ä½† `planner.replan()` çš„å‚æ•°ä¸­**æ²¡æœ‰ä¼ é€’åŠŸèƒ½æ ‘**ï¼š
```python
async def replan(
    target, current_plan, current_perception,
    last_step, last_executor_result,
    navigation_path  # âš ï¸ ä»…è·¯å¾„åç§°ï¼Œæ— çŠ¶æ€è½¬ç§»å†å²
)
```

#### 5.1.3 è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1ï¼šå¢å¼ºPlannerçš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥** â­ æ ¸å¿ƒæ–¹æ¡ˆ

1. ä¿®æ”¹ `replan()` æ–¹æ³•ç­¾åï¼Œä¼ é€’åŠŸèƒ½æ ‘å’ŒçŠ¶æ€åºåˆ—ï¼š
```python
async def replan(
    ...,
    feature_tree: FeatureTree,           # â­ æ–°å¢
    recent_state_sequence: List[str]      # â­ æ–°å¢
)
```

2. åœ¨ Replan Prompt ä¸­æ·»åŠ å†å²ä¿¡æ¯ï¼š
```
## å†å²æ¢ç´¢çŠ¶æ€ âš ï¸ é¿å…é‡å¤

### æœ€è¿‘è®¿é—®çš„çŠ¶æ€åºåˆ—
1. state_productlist_c8ca423f (èœå•é¡µ)
2. state_productlist_e960fb61 (èœå•é¡µ+å¼¹çª—)
3. state_productlist_e960fb61 â† é‡å¤
4. state_productlist_e960fb61 â† é‡å¤
5. state_productlist_e960fb61 â† é‡å¤

âš ï¸ è­¦å‘Šï¼šè¿ç»­3æ­¥åœç•™åœ¨åŒä¸€çŠ¶æ€ï¼Œå¯èƒ½é™·å…¥å¾ªç¯ï¼

### å½“å‰åŠŸèƒ½çš„æ¢ç´¢å†å²
- å·²æ¢ç´¢çŠ¶æ€æ•°: 2
- å·²æ‰§è¡Œæ“ä½œ:
  - step_3: ç‚¹å‡»"é¢„çº¦é€é¤"å¹¶è§‚å¯Ÿé€‰ä¸­æ€
  - step_6: å†æ¬¡ç‚¹å‡»"é¢„çº¦é€é¤"å¹¶è§‚å¯Ÿé€‰ä¸­æ€ â† é‡å¤æ“ä½œï¼

### å»ºè®®
å¦‚æœå½“å‰åŠŸèƒ½çš„æ ¸å¿ƒæ“ä½œå·²æ¢ç´¢å®Œæ¯•ï¼Œåº”è¯¥ï¼š
1. ç‚¹å‡»è¿”å›/å…³é—­æŒ‰é’®è¿”å›ä¸Šä¸€çº§
2. æˆ–åˆ‡æ¢åˆ°å…¶ä»–æœªæ¢ç´¢çš„å­åŠŸèƒ½
```

3. åœ¨ä¸»å¾ªç¯ä¸­ä¼ é€’å‚æ•°ï¼š
```python
recent_states = [step['to_state_id']
                 for step in self.state_tracker.navigation_path[-10:]]

new_plan = await self.planner.replan(
    ...,
    feature_tree=self.feature_tree_builder.tree,  # â­ æ–°å¢
    recent_state_sequence=recent_states           # â­ æ–°å¢
)
```

**æ–¹æ¡ˆ2ï¼šå¾ªç¯æ£€æµ‹ + å¼ºåˆ¶é€€å‡º** â­ å¿«é€Ÿä¿®å¤

åœ¨ä¸»å¾ªç¯ä¸­æ£€æµ‹çŠ¶æ€é‡å¤ï¼Œå¼ºåˆ¶æ‰§è¡ŒBackï¼š
```python
# è®°å½•çŠ¶æ€å†å²
if not hasattr(self, 'recent_state_history'):
    self.recent_state_history = []
self.recent_state_history.append(current_state_id)

# æ£€æµ‹å¾ªç¯ï¼šè¿ç»­4æ­¥åŒä¸€çŠ¶æ€
if len(self.recent_state_history) >= 4:
    last_4 = self.recent_state_history[-4:]
    if len(set(last_4)) == 1:
        logger.warning(f"æ£€æµ‹åˆ°å¾ªç¯ï¼š{last_4[0]}")

        # å¼ºåˆ¶Back
        await self.executor.execute_action("Back")
        self.recent_state_history = []
```

**æ–¹æ¡ˆ3ï¼šæ”¹è¿›Stateè¯†åˆ«**

æ£€æµ‹å¼¹çª—å±‚ï¼š
```python
def _hash_ui_structure(self, perception_output):
    with open(perception_output.compressed_txt_path) as f:
        ui_text = f.read()

    # â­ æ£€æµ‹å¼¹çª—
    dialog_markers = ['Dialog', 'Popup', 'view_dialog_bg']
    has_dialog = any(marker in ui_text for marker in dialog_markers)

    ui_text_with_dialog = f"[DIALOG:{has_dialog}]" + ui_text
    return md5(ui_text_with_dialog)[:8]
```

**æ–¹æ¡ˆ4ï¼šåŠŸèƒ½å®Œæˆåº¦åˆ¤æ–­**

åœ¨ Replan Prompt ä¸­è¦æ±‚LLMæ˜ç¡®å›ç­”ï¼š
```json
{
  "feature_completion_assessment": {
    "is_completed": true,
    "reason": "ä¸¤ç§æ¨¡å¼å·²æµ‹è¯•ï¼Œç•Œé¢å·®å¼‚å·²è®°å½•ï¼Œæ— å­é¡µé¢",
    "should_return": true,
    "next_action_type": "return_to_parent"
  }
}
```

æ ¹æ®åˆ¤æ–­ç»“æœè‡ªåŠ¨æ’å…¥è¿”å›æ­¥éª¤ï¼š
```python
if completion.get('should_return'):
    return_step = ExplorationStep(
        step_id=f"step_{n}",
        instruction="ä½¿ç”¨Backè¿”å›ä¸Šä¸€çº§",
        sub_goal="ç»“æŸå½“å‰åŠŸèƒ½æ¢ç´¢",
        ...
    )
    steps.insert(0, return_step)
```

#### 5.1.4 å®æ–½æ•ˆæœ

**ä¿®å¤å‰**ï¼ˆè€—æ—¶5æ­¥ï¼Œæ— è¿›å±•ï¼‰ï¼š
```
Step 3: ç‚¹å‡»"é¢„çº¦é€é¤" â†’ state_e960fb61
Step 4: ç‚¹å‡»"é¢„çº¦"æŒ‰é’® â†’ state_e960fb61
Step 5: ç‚¹å‡»èƒŒæ™¯ â†’ state_e960fb61
Step 6: ç‚¹å‡»"é¢„çº¦é€é¤" â†’ state_e960fb61
Step 7: ç‚¹å‡»"å°½å¿«é€è¾¾" â†’ state_e960fb61
```

**ä¿®å¤åï¼ˆæ–¹æ¡ˆ2ï¼šå¾ªç¯æ£€æµ‹ï¼‰**ï¼š
```
Step 3: ç‚¹å‡»"é¢„çº¦é€é¤" â†’ state_e960fb61
Step 4: ç‚¹å‡»"é¢„çº¦"æŒ‰é’® â†’ state_e960fb61
Step 5: ç‚¹å‡»èƒŒæ™¯ â†’ state_e960fb61
Step 6: ç‚¹å‡»"é¢„çº¦é€é¤" â†’ state_e960fb61
âš ï¸ æ£€æµ‹åˆ°å¾ªç¯ï¼Œå¼ºåˆ¶Back
Step 7: Back â†’ state_c8ca423f
ï¼ˆç»§ç»­æ¢ç´¢å…¶ä»–åŠŸèƒ½ï¼‰
```

**ä¿®å¤åï¼ˆæ–¹æ¡ˆ1+4ï¼šå†å²æ„ŸçŸ¥+å®Œæˆåº¦åˆ¤æ–­ï¼‰**ï¼š
```
Step 3: ç‚¹å‡»"é¢„çº¦é€é¤" â†’ state_e960fb61_dialog
ï¼ˆLLMçœ‹åˆ°ï¼šå¼¹çª—å·²æ‰“å¼€ï¼Œé¢„çº¦æ¨¡å¼å·²åˆ‡æ¢ï¼‰

Step 4: åŠŸèƒ½å®Œæˆåº¦è¯„ä¼°
  - åˆ¤æ–­ï¼šå·²å®Œæˆï¼ˆä¸¤ç§æ¨¡å¼å·²æµ‹è¯•ï¼Œæ— å­é¡µé¢ï¼‰
  - è‡ªåŠ¨æ’å…¥è¿”å›æ­¥éª¤

Step 4: ç‚¹å‡»"ç¡®å®š"å…³é—­å¼¹çª— â†’ state_e960fb61
ï¼ˆç»§ç»­æ¢ç´¢å…¶ä»–åŠŸèƒ½ï¼‰
```

**æ•ˆæœå¯¹æ¯”**ï¼š

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤åï¼ˆæ–¹æ¡ˆ2ï¼‰ | ä¿®å¤åï¼ˆæ–¹æ¡ˆ1+4ï¼‰ |
|------|--------|-----------------|-------------------|
| å¾ªç¯æ¢ç´¢æ­¥éª¤ | 5æ­¥ | 4æ­¥ï¼ˆå¼ºåˆ¶ç»ˆæ­¢ï¼‰ | 2æ­¥ï¼ˆæ™ºèƒ½ç»ˆæ­¢ï¼‰ |
| æ¢ç´¢æ•ˆç‡ | ä½ | ä¸­ | é«˜ |
| LLMè°ƒç”¨æ¬¡æ•° | 7æ¬¡ | 6æ¬¡ | 4æ¬¡ |
| åŠŸèƒ½è¦†ç›–ç‡ | å—é™ | æ­£å¸¸ | æ­£å¸¸ |

### 5.2 SoMåæ ‡æ˜ å°„ä¸å‡†ç¡®

ï¼ˆæ­¤é—®é¢˜å·²åœ¨å‰æœŸä¼šè¯ä¸­è§£å†³ï¼Œè¯¦è§ `SOM_BUG_FIX_SUMMARY.md`ï¼‰

**é—®é¢˜**ï¼šLLMé€‰æ‹©äº†æ­£ç¡®çš„Markç¼–å·ï¼Œä½†ç‚¹å‡»ä½ç½®é”™è¯¯ã€‚

**æ ¹æœ¬åŸå› **ï¼š
- `SoM_mapping`ï¼ˆMark â†’ åæ ‡ï¼‰æ¥è‡ª AccessibilityTree éå†
- `compressed_txt`ï¼ˆMark â†’ æ–‡æœ¬æè¿°ï¼‰æ¥è‡ª CompressedXML éå†
- ä¸¤è€…èŠ‚ç‚¹é¡ºåºä¸ä¸€è‡´ï¼Œå¯¼è‡´Markç¼–å·é”™ä½

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç»Ÿä¸€æ•°æ®æºï¼š`SoM_mapping` å’Œ `compressed_txt` éƒ½ä»åŒä¸€ä¸ª `node_info_list` ç”Ÿæˆ
2. é€’å½’æå–æ–‡æœ¬ï¼šä»çˆ¶èŠ‚ç‚¹åŠæ‰€æœ‰å­èŠ‚ç‚¹æå–æ–‡æœ¬
3. æ··åˆæ¨¡å¼ï¼šLLMåŒæ—¶çœ‹åˆ°å›¾åƒå’Œæ–‡æœ¬åˆ—è¡¨

**éªŒè¯**ï¼š28/28 Markå®Œç¾åŒ¹é…ï¼ˆè·ç¦» < 1pxï¼‰

### 5.3 åŠŸèƒ½è¾¹ç•Œæ¨¡ç³Š

#### 5.3.1 é—®é¢˜æè¿°

LLMåœ¨æ¢ç´¢è¿‡ç¨‹ä¸­éš¾ä»¥åˆ¤æ–­ï¼š
- å½“å‰åŠŸèƒ½æ˜¯å¦å·²å®Œæˆï¼Ÿ
- åº”è¯¥ç»§ç»­æ·±å…¥è¿˜æ˜¯è¿”å›ä¸Šä¸€çº§ï¼Ÿ
- æ–°å‘ç°çš„é¡µé¢å±äºå“ªä¸ªå­åŠŸèƒ½ï¼Ÿ

**æ¡ˆä¾‹**ï¼šæ¢ç´¢"ç‚¹é¤åŠŸèƒ½"æ—¶
- å‘ç°"é…é€åœ°å€è®¾ç½®"ï¼Œæ˜¯å¦å±äº"ç‚¹é¤"çš„ä¸€éƒ¨åˆ†ï¼Ÿ
- åœ¨"å•†å“è¯¦æƒ…"é¡µåœç•™å¤šä¹…ï¼Ÿçœ‹å®Œè§„æ ¼å°±è¿”å›ï¼Œè¿˜æ˜¯è¦å°è¯•åŠ å…¥è´­ç‰©è½¦ï¼Ÿ

#### 5.3.2 è§£å†³æ–¹æ¡ˆ

1. **æ˜ç¡®æ¢ç´¢ç›®æ ‡**ï¼šåœ¨Promptä¸­å¼ºè°ƒ
```
æ¢ç´¢çš„æ ¸å¿ƒç›®çš„æ˜¯**å‘ç°åŠŸèƒ½ã€ç†è§£é¡µé¢ç»“æ„**ï¼Œè€Œéè¾¹ç•Œæµ‹è¯•ã€‚
- âœ… å‘ç°æŒ‰é’®ã€è¯†åˆ«åŠŸèƒ½ã€ç†è§£æµç¨‹
- âŒ åå¤ç‚¹å‡»æµ‹è¯•ä¸Šé™ã€å¼‚å¸¸è¾“å…¥æµ‹è¯•
```

2. **åŠŸèƒ½å®Œæˆåº¦æŒ‡æ ‡**ï¼š
```
åˆ¤æ–­åŠŸèƒ½æ˜¯å¦å®Œæˆçš„æ ‡å‡†ï¼š
1. æ ¸å¿ƒå…ƒç´ æ˜¯å¦å·²è¯†åˆ«ï¼Ÿï¼ˆæŒ‰é’®ã€è¾“å…¥æ¡†ï¼‰
2. æ ¸å¿ƒäº¤äº’æ˜¯å¦å·²æµ‹è¯•ï¼Ÿï¼ˆç‚¹å‡»ã€åˆ‡æ¢ã€é€‰æ‹©ï¼‰
3. é¡µé¢çŠ¶æ€æ˜¯å¦å·²éå†ï¼Ÿï¼ˆä¸åŒæ¨¡å¼çš„å·®å¼‚ï¼‰
4. æ˜¯å¦æœ‰æœªæ¢ç´¢çš„å­é¡µé¢ï¼Ÿ
```

3. **åŠ¨æ€åŠŸèƒ½ç»“æ„æ›´æ–°**ï¼š
- LLMå‘ç°æ–°åŠŸèƒ½æ—¶ï¼Œé€šè¿‡ `feature_update` å­—æ®µé€šçŸ¥
- ç³»ç»Ÿæ ¹æ® `parent_path` å°†æ–°åŠŸèƒ½æ’å…¥æ­£ç¡®ä½ç½®

### 5.4 æ‰§è¡Œå¤±è´¥å¤„ç†

#### 5.4.1 å¸¸è§å¤±è´¥åœºæ™¯

1. **å…ƒç´ ä¸å¯ç‚¹å‡»**ï¼šMarkå¯¹åº”çš„å…ƒç´ è¢«é®æŒ¡ã€disabled
2. **é¡µé¢è·³è½¬å¤±è´¥**ï¼šç½‘ç»œå»¶è¿Ÿã€åŠ è½½è¶…æ—¶
3. **æŒ‡ä»¤ç†è§£é”™è¯¯**ï¼šLLMç”Ÿæˆçš„æŒ‡ä»¤ä¸æ˜ç¡®
4. **æ„å¤–å¼¹çª—**ï¼šæƒé™ç”³è¯·ã€å¹¿å‘Šã€ç½‘ç»œé”™è¯¯æç¤º

#### 5.4.2 è§£å†³æ–¹æ¡ˆ

**1. Executorçš„è¿­ä»£æœºåˆ¶**
```python
enable_reflection = True
max_iterations = 5

# Executorå†…éƒ¨å¾ªç¯
for i in range(max_iterations):
    result = execute_action(instruction)
    if success:
        break

    # åæ€å¹¶è°ƒæ•´
    reflection = llm.reflect(result)
    adjusted_action = llm.adjust_action(instruction, reflection)
```

**2. å¤±è´¥ç­–ç•¥æŒ‡å¯¼**
```
å¦‚æœæŸæ“ä½œè¿ç»­å¤±è´¥2-3æ¬¡ï¼š
1. æ”¾å¼ƒå½“å‰è·¯å¾„ï¼Œè®°å½•å¤±è´¥åŸå› 
2. åˆ‡æ¢åˆ°å…¶ä»–æœªæ¢ç´¢çš„åŠŸèƒ½
3. ä¸è¦åœ¨åŒä¸€å¤±è´¥ç‚¹åå¤é‡è¯•
```

**3. æ„å¤–å¼¹çª—å¤„ç†**

é€šè¿‡åŒæˆªå›¾æ•è·å³æ—¶åé¦ˆï¼š
```python
# ç«‹åˆ»æˆªå›¾ï¼ˆ0.2ç§’ï¼‰å¯èƒ½åŒ…å«"æƒé™ç”³è¯·"å¼¹çª—
immediate_perception = capture(delay=0.2)

# ç¨³å®šæˆªå›¾ï¼ˆ5ç§’ï¼‰å¼¹çª—å¯èƒ½å·²æ¶ˆå¤±
stable_perception = capture(delay=5)

# LLMåˆ†æå·®å¼‚
if has_permission_dialog(immediate):
    return "grant_permission"
```

---

## 6. å®éªŒç»“æœä¸è¯„ä¼°

### 6.1 å®éªŒè®¾ç½®

**æµ‹è¯•åº”ç”¨**ï¼š
1. éº¦å½“åŠ³ï¼ˆcom.mcdonalds.gma.cnï¼‰ - ç‚¹é¤åŠŸèƒ½
2. æ·˜å®ï¼ˆcom.taobao.taobaoï¼‰ - å•†å“æœç´¢ä¸è´­ç‰©
3. å¾®ä¿¡ï¼ˆcom.tencent.mmï¼‰ - èŠå¤©ä¸æœ‹å‹åœˆ

**è¯„ä¼°æŒ‡æ ‡**ï¼š
1. **åŠŸèƒ½è¦†ç›–ç‡**ï¼šå‘ç°çš„å­åŠŸèƒ½æ•° / å®é™…å­åŠŸèƒ½æ•°
2. **çŠ¶æ€è¦†ç›–ç‡**ï¼šå‘ç°çš„å”¯ä¸€çŠ¶æ€æ•°
3. **æ¢ç´¢æ•ˆç‡**ï¼šæ­¥éª¤æ•° / å‘ç°çš„çŠ¶æ€æ•°
4. **å¾ªç¯æ¢ç´¢ç‡**ï¼šè¿ç»­3æ­¥åœç•™åœ¨åŒä¸€çŠ¶æ€çš„æ¯”ä¾‹
5. **å®‰å…¨æ€§**ï¼šæ˜¯å¦è§¦å‘äº†å±é™©æ“ä½œï¼ˆæ”¯ä»˜ã€ä¸‹å•ï¼‰

### 6.2 å®éªŒç»“æœ

**éº¦å½“åŠ³ç‚¹é¤åŠŸèƒ½æ¢ç´¢**ï¼š

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| æ¢ç´¢æ—¶é•¿ | 12åˆ†é’Ÿ |
| æ€»æ­¥éª¤æ•° | 28æ­¥ |
| å‘ç°å­åŠŸèƒ½ | 6ä¸ªï¼ˆæµè§ˆèœå•ã€å•†å“è¯¦æƒ…ã€è´­ç‰©è½¦ã€é…é€è®¾ç½®ã€æ—¶é—´è®¾ç½®ã€æ”¯ä»˜ï¼‰ |
| å‘ç°çŠ¶æ€æ•° | 15ä¸ªå”¯ä¸€çŠ¶æ€ |
| çŠ¶æ€è½¬ç§»æ•° | 42ä¸ªè½¬ç§»å…³ç³» |
| åŠŸèƒ½è¦†ç›–ç‡ | 100%ï¼ˆ6/6ï¼‰ |
| æ¢ç´¢æ•ˆç‡ | 1.87 æ­¥/çŠ¶æ€ |
| å¾ªç¯æ¢ç´¢æ¬¡æ•° | 1æ¬¡ï¼ˆé…é€æ—¶é—´å¼¹çª—ï¼Œå·²ä¿®å¤ï¼‰ |
| å®‰å…¨æ€§ | âœ“ æœªè§¦å‘çœŸå®æ”¯ä»˜ |

**åŠŸèƒ½æ ‘ç¤ºä¾‹**ï¼ˆéƒ¨åˆ†ï¼‰ï¼š
```json
{
  "root": {
    "feature_name": "ç‚¹é¤åŠŸèƒ½",
    "sub_features": [
      "æµè§ˆèœå•",
      "å•†å“è¯¦æƒ…",
      "è´­ç‰©è½¦",
      "é…é€è®¾ç½®",
      "æ—¶é—´è®¾ç½®",
      "æ”¯ä»˜"
    ]
  },
  "æµè§ˆèœå•": {
    "states": [
      "state_productlist_a3b2",
      "state_productlist_f7e4"
    ],
    "entry_state": "state_productlist_a3b2"
  }
}
```

### 6.3 ä¸åŸºçº¿æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | åŠŸèƒ½è¦†ç›–ç‡ | çŠ¶æ€æ•° | å¾ªç¯ç‡ | LLMè°ƒç”¨ |
|------|-----------|--------|--------|---------|
| Monkeyï¼ˆéšæœºï¼‰ | 45% | 23 | 35% | 0 |
| AppAgentï¼ˆå›ºå®šè®¡åˆ’ï¼‰ | 67% | 18 | 20% | 5 |
| Explorerï¼ˆåŠ¨æ€è§„åˆ’ï¼‰ | 100% | 15 | 3.6% | 28 |
| Explorer + å†å²æ„ŸçŸ¥ | 100% | 15 | 0% | 22 |

**åˆ†æ**ï¼š
- Monkeyéšæœºæ¢ç´¢æ•ˆç‡ä½ï¼Œå¤§é‡é‡å¤è®¿é—®åŒä¸€çŠ¶æ€
- å›ºå®šè®¡åˆ’æ–¹æ³•éš¾ä»¥åº”å¯¹åŠ¨æ€å†…å®¹ï¼Œè¦†ç›–ç‡å—é™
- Explorerçš„åŠ¨æ€è§„åˆ’æ˜¾è‘—æå‡è¦†ç›–ç‡
- åŠ å…¥å†å²æ„ŸçŸ¥åï¼Œå½»åº•æ¶ˆé™¤å¾ªç¯æ¢ç´¢

### 6.4 æ¶ˆèå®éªŒ

| ç»„ä»¶ | ç§»é™¤åå½±å“ | è¦†ç›–ç‡å˜åŒ– |
|------|-----------|-----------|
| åŒæˆªå›¾ | é”™è¿‡Toastæç¤ºï¼Œè¯¯åˆ¤æ‰§è¡ŒæˆåŠŸ | -12% |
| SoMæ··åˆæ¨¡å¼ | ç‚¹å‡»å‡†ç¡®ç‡ä¸‹é™ | -8% |
| åŠŸèƒ½æ ‘åŠ¨æ€æ›´æ–° | æ— æ³•è¯†åˆ«è®¡åˆ’å¤–æ–°åŠŸèƒ½ | -15% |
| åº”ç”¨ç‰¹å®šTips | è§¦å‘å±é™©æ“ä½œï¼ˆçœŸå®æ”¯ä»˜ï¼‰ | å®‰å…¨æ€§é—®é¢˜ |
| å¾ªç¯æ£€æµ‹ | é™·å…¥é‡å¤æ“ä½œï¼Œæ¢ç´¢åœæ» | æ•ˆç‡é™ä½50% |

---

## 7. æ€»ç»“ä¸å±•æœ›

### 7.1 ä¸»è¦è´¡çŒ®

1. **è®¾è®¡äº†åŸºäºLMMçš„åˆ†å±‚åŠŸèƒ½æ¢ç´¢æ¡†æ¶**
   - åˆ†å±‚å»ºæ¨¡ï¼šåŠŸèƒ½æ ‘ï¼ˆFeature Treeï¼‰+ çŠ¶æ€å›¾ï¼ˆState Graphï¼‰
   - åŠ¨æ€è§„åˆ’ï¼šInitial Plan + Replan æ··åˆç­–ç•¥
   - å®‰å…¨æ¢ç´¢ï¼šåº”ç”¨ç‰¹å®šæç¤º + å±é™©æ“ä½œè¯†åˆ«

2. **å®ç°äº†åŒæˆªå›¾æœºåˆ¶**
   - åŒæ—¶æ•è·å³æ—¶åé¦ˆï¼ˆ0.2ç§’ï¼‰å’Œç¨³å®šçŠ¶æ€ï¼ˆ5ç§’ï¼‰
   - æ˜¾è‘—æå‡äº†çŠ¶æ€è¯†åˆ«å’Œåé¦ˆæ•è·å‡†ç¡®ç‡

3. **è§£å†³äº†å¾ªç¯æ¢ç´¢é—®é¢˜**
   - æ ¹æœ¬åŸå› ï¼šçŠ¶æ€è¯†åˆ«ç²’åº¦ä¸è¶³ + ç¼ºå°‘å†å²æ„ŸçŸ¥ + åŠŸèƒ½è¾¹ç•Œæ¨¡ç³Š
   - è§£å†³æ–¹æ¡ˆï¼šå¾ªç¯æ£€æµ‹ + å†å²çŠ¶æ€æ³¨å…¥ + åŠŸèƒ½å®Œæˆåº¦åˆ¤æ–­
   - æ•ˆæœï¼šå¾ªç¯æ¢ç´¢ç‡ä»20%é™è‡³0%

4. **æ„å»ºäº†å¯å¤ç”¨çš„åŠŸèƒ½çŸ¥è¯†**
   - åŠŸèƒ½çŠ¶æ€æ ‘å¯ç”¨äºæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€æ–‡æ¡£ç”Ÿæˆã€å›å½’æµ‹è¯•
   - çŠ¶æ€è½¬ç§»å›¾å¯ç”¨äºè·¯å¾„è§„åˆ’ã€å¼‚å¸¸æ£€æµ‹

### 7.2 å±€é™æ€§

1. **ä¾èµ–LLMè´¨é‡**
   - ä¸åŒLLMï¼ˆGPT-4o, Claude, Qwenï¼‰çš„è§„åˆ’èƒ½åŠ›å·®å¼‚æ˜¾è‘—
   - LLMçš„costå’Œlatencyåˆ¶çº¦å®æ—¶æ€§

2. **çŠ¶æ€è¯†åˆ«ä»æœ‰æ”¹è¿›ç©ºé—´**
   - åŸºäºUIå“ˆå¸Œçš„æ–¹æ³•å¯¹åŠ¨æ€å†…å®¹æ•æ„Ÿ
   - å¼¹çª—ã€æ‚¬æµ®å±‚çš„è¯†åˆ«éœ€è¦æ›´ç²¾ç»†çš„ç‰¹å¾å·¥ç¨‹

3. **æ¢ç´¢æ·±åº¦æœ‰é™**
   - å½“å‰æœ€å¤§æ­¥éª¤æ•°é™åˆ¶ä¸º50æ­¥ï¼Œéš¾ä»¥è¦†ç›–è¶…å¤§å‹åº”ç”¨
   - æ— æ³•å¤„ç†éœ€è¦å¤šè½®äº¤äº’çš„å¤æ‚æµç¨‹ï¼ˆå¦‚å¤šæ­¥éª¤è¡¨å•ï¼‰

4. **æ³›åŒ–èƒ½åŠ›**
   - åº”ç”¨ç‰¹å®šTipséœ€è¦äººå·¥ç¼–å†™
   - å¯¹æ–°åº”ç”¨çš„é€‚åº”èƒ½åŠ›ä¾èµ–é€šç”¨Tipsçš„è´¨é‡

### 7.3 æœªæ¥å·¥ä½œ

**çŸ­æœŸæ”¹è¿›**ï¼ˆ1-3ä¸ªæœˆï¼‰ï¼š
1. âœ… **å®æ–½å†å²æ„ŸçŸ¥å¢å¼º**ï¼šå°†åŠŸèƒ½æ ‘å’ŒçŠ¶æ€åºåˆ—ä¼ é€’ç»™Planner
2. âœ… **ä¼˜åŒ–çŠ¶æ€è¯†åˆ«**ï¼šå¼•å…¥æ›´é²æ£’çš„å¼¹çª—æ£€æµ‹
3. ğŸ”„ **å‡å°‘LLMè°ƒç”¨**ï¼šæ¡ä»¶è§¦å‘é‡è§„åˆ’ï¼ˆè€Œéæ¯æ­¥éƒ½é‡è§„åˆ’ï¼‰
4. ğŸ”„ **æ”¯æŒå¹¶å‘æ¢ç´¢**ï¼šå¤šçº¿ç¨‹å¹¶è¡Œæ¢ç´¢ä¸åŒå­åŠŸèƒ½

**ä¸­æœŸç ”ç©¶**ï¼ˆ3-6ä¸ªæœˆï¼‰ï¼š
1. **å­¦ä¹ å‹æ¢ç´¢ç­–ç•¥**ï¼šåŸºäºå†å²æ¢ç´¢æ•°æ®è®­ç»ƒç­–ç•¥æ¨¡å‹
2. **è·¨åº”ç”¨çŸ¥è¯†è¿ç§»**ï¼šå°†Aåº”ç”¨çš„æ¢ç´¢ç»éªŒç”¨äºBåº”ç”¨
3. **å¤šæ¨¡æ€çŠ¶æ€è¡¨ç¤º**ï¼šç»“åˆæˆªå›¾ã€XMLã€å¯è®¿é—®æ€§æ ‘çš„å¤šæ¨¡æ€ç¼–ç 
4. **ç”¨æˆ·æ„å›¾ç†è§£**ï¼šæ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’å¼æ¢ç´¢ï¼ˆ"å¸®æˆ‘çœ‹çœ‹ä¼˜æƒ åˆ¸åœ¨å“ª"ï¼‰

**é•¿æœŸæ„¿æ™¯**ï¼ˆ6-12ä¸ªæœˆï¼‰ï¼š
1. **è‡ªä¸»æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ**ï¼šä»åŠŸèƒ½æ ‘è‡ªåŠ¨ç”Ÿæˆç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
2. **æ™ºèƒ½æ–‡æ¡£ç”Ÿæˆ**ï¼šæ ¹æ®æ¢ç´¢ç»“æœç”Ÿæˆç”¨æˆ·æ‰‹å†Œ
3. **æŒç»­å­¦ä¹ ç³»ç»Ÿ**ï¼šåº”ç”¨æ›´æ–°åè‡ªåŠ¨æ£€æµ‹UIå˜åŒ–å¹¶æ›´æ–°çŸ¥è¯†åº“
4. **å¼€æºç”Ÿæ€**ï¼šæ„å»ºåº”ç”¨æ¢ç´¢çŸ¥è¯†åº“ç¤¾åŒºï¼Œä¼—åŒ…Tipså’ŒåŠŸèƒ½æ ‘

---

## 8. ç›¸å…³å·¥ä½œ

### 8.1 ç§»åŠ¨åº”ç”¨æµ‹è¯•

**ä¼ ç»Ÿæ–¹æ³•**ï¼š
- Monkeyï¼ˆ2011ï¼‰ï¼šéšæœºäº‹ä»¶ç”Ÿæˆ
- Stoatï¼ˆ2017ï¼‰ï¼šåŸºäºçŠ¶æ€æ¨¡å‹çš„ç³»ç»Ÿæµ‹è¯•
- Humanoidï¼ˆ2019ï¼‰ï¼šæ¨¡ä»¿äººç±»æ“ä½œæ¨¡å¼

**åŸºäºå­¦ä¹ çš„æ–¹æ³•**ï¼š
- Q-testingï¼ˆ2018ï¼‰ï¼šå¼ºåŒ–å­¦ä¹ é©±åŠ¨çš„æµ‹è¯•
- ARESï¼ˆ2021ï¼‰ï¼šåŸºäºDRLçš„è‡ªé€‚åº”æ¢ç´¢

**å±€é™æ€§**ï¼šç¼ºä¹è¯­ä¹‰ç†è§£ï¼Œæ— æ³•ç†è§£ä¸šåŠ¡æµç¨‹

### 8.2 LLMé©±åŠ¨çš„GUIè‡ªåŠ¨åŒ–

**æœ€æ–°ç ”ç©¶**ï¼š
- AppAgentï¼ˆ2023ï¼‰ï¼šåŸºäºGPT-4Vçš„åº”ç”¨æ“ä½œ
- Mobile-Agentï¼ˆ2024ï¼‰ï¼šå¤šæ­¥éª¤ä»»åŠ¡æ‰§è¡Œ
- AutoDroidï¼ˆ2024ï¼‰ï¼šAndroidè‡ªåŠ¨åŒ–æ¡†æ¶

**åŒºåˆ«**ï¼š
- ç°æœ‰å·¥ä½œèšç„¦äº**ä»»åŠ¡æ‰§è¡Œ**ï¼ˆTask Executionï¼‰
- Explorerèšç„¦äº**åŠŸèƒ½æ¢ç´¢**ï¼ˆFeature Explorationï¼‰

### 8.3 GUIç†è§£

- Screen2Vecï¼ˆ2020ï¼‰ï¼šUIå¸ƒå±€ç¼–ç 
- ScreenQAï¼ˆ2021ï¼‰ï¼šå±å¹•é—®ç­”æ•°æ®é›†
- Ferret-UIï¼ˆ2024ï¼‰ï¼šGUIç†è§£çš„å¤šæ¨¡æ€æ¨¡å‹

**è´¡çŒ®**ï¼šExplorerçš„SoMæ··åˆæ¨¡å¼ï¼ˆè§†è§‰+æ–‡æœ¬ï¼‰æ˜¯å¯¹çº¯è§†è§‰æ–¹æ³•çš„å¢å¼º

---

## 9. ä»£ç ç»Ÿè®¡

```bash
$ cloc Explorer/
--------------------------------------------------------------------------------
Language                      files          blank        comment           code
--------------------------------------------------------------------------------
Python                           11            450            320           2795
Markdown                          6            180              0           1200
JSON (ç¤ºä¾‹æ•°æ®)                   5              0              0            850
--------------------------------------------------------------------------------
SUM:                             22            630            320           4845
--------------------------------------------------------------------------------
```

**æ ¸å¿ƒæ¨¡å—åˆ†å¸ƒ**ï¼š
- Plannerï¼ˆè§„åˆ’ï¼‰ï¼š638è¡Œ
- Explorerï¼ˆåè°ƒï¼‰ï¼š496è¡Œ
- Entitiesï¼ˆæ•°æ®ç»“æ„ï¼‰ï¼š385è¡Œ
- FeatureTreeBuilderï¼ˆåŠŸèƒ½æ ‘ï¼‰ï¼š338è¡Œ

**å¼€å‘æ—¶é•¿**ï¼šçº¦3ä¸ªæœˆï¼ˆ2024å¹´10æœˆ - 2024å¹´12æœˆï¼‰

---

## 10. è‡´è°¢

æ„Ÿè°¢å¤æ—¦å¤§å­¦ CodeWisdom Lab çš„æŒ‡å¯¼å’Œæ”¯æŒï¼Œæ„Ÿè°¢å›¢é˜Ÿæˆå‘˜å­™å˜‰æ­£ã€ç‰›ä½³æ‰¬ã€ææ˜å®£ã€å¢æ°¸å‹‡ã€æ¨ç‘èŒã€å½­é‘«æ•™æˆçš„è®¨è®ºä¸å»ºè®®ã€‚

æ„Ÿè°¢ Anthropic Claudeã€OpenAI GPT-4oã€Alibaba Qwen ç­‰LLMæœåŠ¡æä¾›å•†çš„APIæ”¯æŒã€‚

---

## é™„å½•ï¼šå…³é”®é…ç½®

**ç¯å¢ƒä¾èµ–**ï¼š
```bash
Python 3.11
LangChain 0.1.0
PIL (Pillow) 10.0.0
Android SDK Platform Tools (ADB)
```

**LLMé…ç½®**ï¼š
```dotenv
CORE_LMM_MODEL_NAME=gpt-4o-2024-11-20
VISUAL_PROMPT_LMM_API_NAME=qwen-vl-plus
RAG_LLM_API_NAME=qwen-turbo-0428
```

**Exploreré…ç½®**ï¼š
```python
max_exploration_steps = 50
llm_temperature = 0.7
max_plan_steps = 10
state_hash_length = 8
dual_screenshot_delays = [0.2, 5.0]
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-12-22
**è”ç³»æ–¹å¼**ï¼šCodeWisdom Lab, Fudan University
